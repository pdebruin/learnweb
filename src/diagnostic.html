<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Compatibility Diagnostic Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 40px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .info-section {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .info-section h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .info-section p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 8px;
        }
        
        .test-section {
            margin-bottom: 30px;
        }
        
        .test-button {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .test-button:hover {
            background: #5568d3;
        }
        
        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .results {
            background: #f5f5f5;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .result-success {
            color: #008800;
            margin-bottom: 5px;
        }
        
        .result-error {
            color: #cc0000;
            margin-bottom: 5px;
        }
        
        .result-info {
            color: #0066cc;
            margin-bottom: 5px;
        }
        
        .result-warning {
            color: #ff8800;
            margin-bottom: 5px;
        }
        
        code {
            background: #e8e8e8;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Browser Compatibility Diagnostic Tool</h1>
        <p class="subtitle">This tool helps diagnose CORS and browser compatibility issues</p>
        
        <div class="info-section">
            <h3>Browser Information</h3>
            <p><strong>User Agent:</strong> <span id="userAgent"></span></p>
            <p><strong>Browser:</strong> <span id="browserName"></span></p>
            <p><strong>Platform:</strong> <span id="platform"></span></p>
            <p><strong>Current Origin:</strong> <span id="currentOrigin"></span></p>
        </div>
        
        <div class="test-section">
            <h3>Available Tests</h3>
            <button class="test-button" onclick="testCORS()">Test CORS Headers</button>
            <button class="test-button" onclick="testFetch()">Test Fetch API</button>
            <button class="test-button" onclick="testEventSource()">Test EventSource</button>
            <button class="test-button" onclick="testAll()">Run All Tests</button>
            <button class="test-button" onclick="clearResults()">Clear Results</button>
        </div>
        
        <div class="results" id="results">
            <div class="result-info">Ready to run diagnostics...</div>
        </div>
    </div>
    
    <script>
        const API_ENDPOINT = 'https://learn.microsoft.com/api/mcp';
        const resultsDiv = document.getElementById('results');
        
        // Display browser information
        document.getElementById('userAgent').textContent = navigator.userAgent;
        document.getElementById('platform').textContent = navigator.platform;
        document.getElementById('currentOrigin').textContent = window.location.origin;
        
        // Detect browser name
        function getBrowserName() {
            const ua = navigator.userAgent;
            if (ua.includes('Firefox/')) return 'Firefox';
            if (ua.includes('Edg/')) return 'Edge';
            if (ua.includes('Chrome/')) return 'Chrome';
            if (ua.includes('Safari/') && !ua.includes('Chrome/')) return 'Safari';
            return 'Unknown';
        }
        document.getElementById('browserName').textContent = getBrowserName();
        
        function addLog(message, type = 'info') {
            const logEntry = document.createElement('div');
            logEntry.className = `result-${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            resultsDiv.appendChild(logEntry);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        function clearResults() {
            resultsDiv.innerHTML = '<div class="result-info">Results cleared. Ready for new tests...</div>';
        }
        
        async function testCORS() {
            addLog('=== Testing CORS Configuration ===', 'info');
            
            // Test 1: Check if fetch is available
            if (typeof fetch === 'undefined') {
                addLog('ERROR: Fetch API not supported in this browser', 'error');
                return;
            }
            addLog('‚úì Fetch API is supported', 'success');
            
            // Test 2: Try OPTIONS request (CORS preflight)
            try {
                addLog('Sending OPTIONS request to check CORS headers...', 'info');
                const response = await fetch(API_ENDPOINT, {
                    method: 'OPTIONS',
                    mode: 'cors',
                    credentials: 'omit'
                });
                addLog(`‚úì OPTIONS request status: ${response.status}`, 'success');
                
                // Check CORS headers
                const allowOrigin = response.headers.get('Access-Control-Allow-Origin');
                const allowMethods = response.headers.get('Access-Control-Allow-Methods');
                const allowHeaders = response.headers.get('Access-Control-Allow-Headers');
                
                if (allowOrigin) {
                    addLog(`‚úì Access-Control-Allow-Origin: ${allowOrigin}`, 'success');
                } else {
                    addLog('‚úó No Access-Control-Allow-Origin header found', 'error');
                }
                
                if (allowMethods) {
                    addLog(`‚úì Access-Control-Allow-Methods: ${allowMethods}`, 'success');
                } else {
                    addLog('‚úó No Access-Control-Allow-Methods header found', 'warning');
                }
                
            } catch (error) {
                addLog(`‚úó OPTIONS request failed: ${error.message}`, 'error');
            }
        }
        
        async function testFetch() {
            addLog('=== Testing Fetch with CORS ===', 'info');
            
            try {
                addLog('Attempting fetch with mode=cors, credentials=omit...', 'info');
                const response = await fetch(API_ENDPOINT, {
                    method: 'GET',
                    mode: 'cors',
                    credentials: 'omit',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                addLog(`‚úì Fetch succeeded! Status: ${response.status}`, 'success');
                addLog(`Response type: ${response.type}`, 'info');
                
                if (response.ok) {
                    const contentType = response.headers.get('content-type');
                    addLog(`Content-Type: ${contentType}`, 'info');
                } else {
                    addLog(`Response not OK: ${response.statusText}`, 'warning');
                }
                
            } catch (error) {
                addLog(`‚úó Fetch failed: ${error.message}`, 'error');
                
                // Detailed error analysis
                if (error.message.includes('CORS')) {
                    addLog('This is a CORS error. The server does not allow this origin.', 'error');
                } else if (error.message.includes('Failed to fetch')) {
                    addLog('Network error or CORS blocking. Check browser console.', 'error');
                }
            }
        }
        
        async function testEventSource() {
            addLog('=== Testing EventSource (SSE) ===', 'info');
            
            if (typeof EventSource === 'undefined') {
                addLog('‚úó EventSource not supported in this browser', 'error');
                return;
            }
            addLog('‚úì EventSource is supported', 'success');
            
            try {
                addLog('Creating EventSource connection...', 'info');
                const eventSource = new EventSource(API_ENDPOINT, {
                    withCredentials: false
                });
                
                let connectionTimeout = setTimeout(() => {
                    addLog('EventSource connection timeout after 5 seconds', 'warning');
                    eventSource.close();
                }, 5000);
                
                eventSource.onopen = () => {
                    clearTimeout(connectionTimeout);
                    addLog('‚úì EventSource connection opened successfully!', 'success');
                    addLog(`ReadyState: ${eventSource.readyState}`, 'info');
                    eventSource.close();
                };
                
                eventSource.onerror = (error) => {
                    clearTimeout(connectionTimeout);
                    addLog(`‚úó EventSource error: ${error.type || 'Connection failed'}`, 'error');
                    addLog(`ReadyState: ${eventSource.readyState}`, 'info');
                    eventSource.close();
                };
                
                eventSource.onmessage = (event) => {
                    addLog(`Message received: ${event.data.substring(0, 100)}...`, 'info');
                };
                
            } catch (error) {
                addLog(`‚úó EventSource failed: ${error.message}`, 'error');
            }
        }
        
        async function testAll() {
            clearResults();
            addLog('=== Running All Diagnostic Tests ===', 'info');
            addLog(`Browser: ${getBrowserName()}`, 'info');
            addLog(`Origin: ${window.location.origin}`, 'info');
            addLog('', 'info');
            
            await testCORS();
            addLog('', 'info');
            await testFetch();
            addLog('', 'info');
            await testEventSource();
            addLog('', 'info');
            addLog('=== All Tests Complete ===', 'info');
            
            // Summary
            addLog('', 'info');
            addLog('üìã SUMMARY:', 'info');
            addLog('If all tests failed with CORS errors, the API does not allow this origin.', 'warning');
            addLog('Try accessing from localhost or GitHub Pages URL.', 'warning');
        }
    </script>
</body>
</html>
